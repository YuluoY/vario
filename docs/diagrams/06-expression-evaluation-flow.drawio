<mxGraphModel>
  <root>
    <mxCell id="0"/>
    <mxCell id="1" parent="0"/>
    
    <!-- 标题 -->
    <mxCell id="title" value="Vario Expression Evaluation Flow (Safe Sandbox)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;" vertex="1" parent="1">
      <mxGeometry x="40" y="10" width="720" height="25" as="geometry"/>
    </mxCell>
    
    <!-- Start -->
    <mxCell id="start" value="Start&#xa;Evaluate Expression" style="shape=ellipse;fillColor=#4CAF50;strokeColor=#2E7D32;fontSize=12;fontStyle=1;align=center;verticalAlign=middle;fontColor=#FFFFFF;" vertex="1" parent="1">
      <mxGeometry x="340" y="60" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Input Expression -->
    <mxCell id="input" value="Input&#xa;Expression String" style="rounded=1;fillColor=#E1F5FE;strokeColor=#0288D1;fontSize=12;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;html=1;" vertex="1" parent="1">
      <mxGeometry x="340" y="150" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Parse AST -->
    <mxCell id="parse" value="Parse AST&#xa;Generate Syntax Tree" style="rounded=1;fillColor=#FFF3E0;strokeColor=#E65100;fontSize=12;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;html=1;" vertex="1" parent="1">
      <mxGeometry x="340" y="240" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Whitelist Check -->
    <mxCell id="whitelist" value="AST Whitelist&#xa;Check Syntax" style="rhombus;fillColor=#FFF9C4;strokeColor=#F57F17;fontSize=12;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;html=1;" vertex="1" parent="1">
      <mxGeometry x="300" y="330" width="200" height="60" as="geometry"/>
    </mxCell>
    
    <!-- Security Check -->
    <mxCell id="security" value="Security Check&#xa;• No Side Effects&#xa;• No Globals&#xa;• Read-only" style="rounded=1;fillColor=#FFEBEE;strokeColor=#C62828;fontSize=11;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;html=1;" vertex="1" parent="1">
      <mxGeometry x="340" y="430" width="120" height="70" as="geometry"/>
    </mxCell>
    
    <!-- Create Sandbox -->
    <mxCell id="sandbox" value="Create Sandbox&#xa;Proxy Context" style="rounded=1;fillColor=#E8F5E9;strokeColor=#2E7D32;fontSize=12;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;html=1;" vertex="1" parent="1">
      <mxGeometry x="340" y="540" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Evaluate -->
    <mxCell id="evaluate" value="Evaluate&#xa;In Sandbox" style="rounded=1;fillColor=#E8F5E9;strokeColor=#2E7D32;fontSize=12;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;html=1;" vertex="1" parent="1">
      <mxGeometry x="80" y="430" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Return Result -->
    <mxCell id="return" value="Return Result" style="rounded=1;fillColor=#E1F5FE;strokeColor=#0288D1;fontSize=12;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;html=1;" vertex="1" parent="1">
      <mxGeometry x="80" y="330" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- Error Handler -->
    <mxCell id="error" value="Throw Error&#xa;Invalid Syntax" style="rounded=1;fillColor=#FFEBEE;strokeColor=#C62828;fontSize=12;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;html=1;" vertex="1" parent="1">
      <mxGeometry x="560" y="330" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- End -->
    <mxCell id="end" value="End" style="shape=ellipse;fillColor=#4CAF50;strokeColor=#2E7D32;fontSize=12;fontStyle=1;align=center;verticalAlign=middle;fontColor=#FFFFFF;" vertex="1" parent="1">
      <mxGeometry x="80" y="240" width="120" height="50" as="geometry"/>
    </mxCell>
    
    <!-- 连线: Start -> Input -->
    <mxCell id="edge-start-input" value="" style="endArrow=classic;edgeStyle=orthogonalEdgeStyle;curved=1;strokeColor=#546E7A;strokeWidth=2;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="start" target="input">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <!-- 连线: Input -> Parse -->
    <mxCell id="edge-input-parse" value="" style="endArrow=classic;edgeStyle=orthogonalEdgeStyle;curved=1;strokeColor=#546E7A;strokeWidth=2;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="input" target="parse">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <!-- 连线: Parse -> Whitelist -->
    <mxCell id="edge-parse-whitelist" value="" style="endArrow=classic;edgeStyle=orthogonalEdgeStyle;curved=1;strokeColor=#546E7A;strokeWidth=2;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="parse" target="whitelist">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <!-- 连线: Whitelist -> Security (Pass) -->
    <mxCell id="edge-whitelist-security" value="Pass" style="endArrow=classic;edgeStyle=orthogonalEdgeStyle;curved=1;strokeColor=#546E7A;strokeWidth=2;exitX=0.5;exitY=1;entryX=0.5;entryY=0;fontSize=11;" edge="1" parent="1" source="whitelist" target="security">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <!-- 连线: Whitelist -> Error (Fail) -->
    <mxCell id="edge-whitelist-error" value="Fail" style="endArrow=classic;edgeStyle=orthogonalEdgeStyle;curved=1;strokeColor=#C62828;strokeWidth=2;exitX=1;exitY=0.5;entryX=0;entryY=0.5;fontSize=11;" edge="1" parent="1" source="whitelist" target="error">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <!-- 连线: Security -> Sandbox -->
    <mxCell id="edge-security-sandbox" value="" style="endArrow=classic;edgeStyle=orthogonalEdgeStyle;curved=1;strokeColor=#546E7A;strokeWidth=2;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="security" target="sandbox">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <!-- 连线: Sandbox -> Evaluate -->
    <mxCell id="edge-sandbox-evaluate" value="" style="endArrow=classic;edgeStyle=orthogonalEdgeStyle;curved=1;strokeColor=#546E7A;strokeWidth=2;exitX=0;exitY=0.5;entryX=1;entryY=0.5;fontSize=11;" edge="1" parent="1" source="sandbox" target="evaluate">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <!-- 连线: Evaluate -> Return -->
    <mxCell id="edge-evaluate-return" value="" style="endArrow=classic;edgeStyle=orthogonalEdgeStyle;curved=1;strokeColor=#546E7A;strokeWidth=2;exitX=0.5;exitY=0;entryX=0.5;entryY=1;fontSize=11;" edge="1" parent="1" source="evaluate" target="return">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <!-- 连线: Return -> End -->
    <mxCell id="edge-return-end" value="" style="endArrow=classic;edgeStyle=orthogonalEdgeStyle;curved=1;strokeColor=#546E7A;strokeWidth=2;exitX=0.5;exitY=0;entryX=0.5;entryY=1;fontSize=11;" edge="1" parent="1" source="return" target="end">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    
    <!-- 安全说明 -->
    <mxCell id="security-note" value="Security Guarantees:&#xa;• AST whitelist ensures only safe syntax&#xa;• Sandbox prevents access to globals&#xa;• Read-only evaluation prevents mutations" style="text;html=1;strokeColor=#546E7A;fillColor=#ECEFF1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=10;fontStyle=0;" vertex="1" parent="1">
      <mxGeometry x="560" y="430" width="120" height="80" as="geometry"/>
    </mxCell>
  </root>
</mxGraphModel>